<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StudentStream Status</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #0b0f1a;
  color: #eaeaf0;
}

header {
  padding: 24px;
  background: #0f1629;
  border-bottom: 1px solid #1e2a4a;
}

h1 {
  margin: 0;
  font-size: 22px;
}

.container {
  max-width: 900px;
  margin: auto;
  padding: 20px;
}

.component {
  display: flex;
  justify-content: space-between;
  padding: 14px;
  margin-bottom: 10px;
  background: #121a33;
  border-radius: 10px;
  border: 1px solid #1e2a4a;
}

.status-ok { color: #4ade80; }
.status-down { color: #f87171; }
.status-degraded { color: #facc15; }

.incident {
  background: #1a1220;
  border: 1px solid #3b1a55;
  padding: 14px;
  border-radius: 10px;
  margin-bottom: 10px;
}

.loading {
  opacity: 0.6;
}

.error {
  background: #2a1111;
  color: #ffb4b4;
  padding: 12px;
  border-radius: 8px;
}
</style>
</head>

<body>

<header>
  <h1>ðŸš¦ StudentStream System Status</h1>
</header>

<div class="container">

<h2>System Components</h2>
<div id="components" class="loading">Loading componentsâ€¦</div>

<h2>Incidents</h2>
<div id="incidents" class="loading">Loading incidentsâ€¦</div>

<div id="errors"></div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script>
const SUPABASE_URL = "YOUR_URL";
const SUPABASE_ANON_KEY = "YOUR_KEY";

const debug = document.getElementById("debug");
const componentsDiv = document.getElementById("components");

function log(msg) {
  debug.textContent += "\n" + msg;
}

async function loadStatus() {
  log("Creating client...");

  const supabase = supabaseJs.createClient(
    SUPABASE_URL,
    SUPABASE_ANON_KEY
  );

  log("Querying status_components...");

  const { data, error } = await supabase
    .from("status_components")
    .select("*")
    .order("order_index");

  if (error) {
    log("ERROR: " + JSON.stringify(error));
    componentsDiv.textContent = "Failed to load.";
    return;
  }

  log("Loaded " + data.length + " components");

  componentsDiv.innerHTML = "";

  data.forEach(c => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <strong>${c.name}</strong><br>
      ${c.description}<br>
      Status: <span class="ok">${c.status}</span>
    `;
    componentsDiv.appendChild(div);
  });
}

loadStatus();
</script>