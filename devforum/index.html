<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StudentStream DevForum</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  background:#0e0e14;
  color:white;
  font-family:system-ui;
  padding:20px;
}

h1{margin-bottom:10px;}

.thread{
  background:#15151c;
  padding:14px;
  border-radius:10px;
  margin-bottom:12px;
}

.thread-title{
  font-size:17px;
  font-weight:700;
}

.user-row{
  display:flex;
  align-items:center;
  gap:8px;
  margin-top:6px;
  font-size:13px;
}

/* ---------- BADGES SYSTEM ---------- */

.badge{
  position:relative;
  padding:4px 10px;
  border-radius:999px;
  font-size:10px;
  font-weight:900;
  letter-spacing:1px;
  border:1px solid rgba(255,255,255,0.2);
  text-transform:uppercase;
}

.owner{
  background: linear-gradient(135deg,#ff0080,#7928ff,#00e0ff);
  background-size:300% 300%;
  animation: ownerGlow 3s ease infinite;
  box-shadow:0 0 10px rgba(255,0,128,.8);
}

.admin{
  background:linear-gradient(135deg,#ffb300,#ff6a00);
  box-shadow:0 0 10px rgba(255,170,0,.7);
}

.mod{
  background:linear-gradient(135deg,#00ff99,#00b36b);
  box-shadow:0 0 10px rgba(0,255,153,.6);
}

.badge::after{
  content:attr(data-tooltip);
  position:absolute;
  bottom:130%;
  left:50%;
  transform:translateX(-50%);
  background:#0d0d14;
  padding:6px 10px;
  border-radius:6px;
  font-size:11px;
  opacity:0;
  pointer-events:none;
  transition:.2s;
}

.badge:hover::after{opacity:1;}

@keyframes ownerGlow{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
</style>
</head>
<body>

<h1>StudentStream DevForum</h1>
<div id="threads"></div>

<script>
const supabaseUrl = "https://iabzmoxzbqzcqgypxctr.supabase.co";
const supabaseKey = "sb_publishable_ipn8wnT_TIvaT6r44j8YBw_t5oMhOPC";
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

const threadsDiv = document.getElementById("threads");

function badgeHTML(role){
  if(role === "owner") return `<span class="badge owner" data-tooltip="Founder of StudentStream ðŸ‘‘">OWNER</span>`;
  if(role === "admin") return `<span class="badge admin" data-tooltip="StudentStream Administrator">ADMIN</span>`;
  if(role === "mod") return `<span class="badge mod" data-tooltip="Forum Moderator">MOD</span>`;
  return "";
}

async function loadThreads(){
  const { data, error } = await supabase
    .from("threads")
    .select("id,title,created_at, profiles(username, role)")
    .order("created_at", { ascending:false });

  threadsDiv.innerHTML = "";

  data.forEach(thread=>{
    const user = thread.profiles;
    const badge = badgeHTML(user.role);

    threadsDiv.innerHTML += `
      <div class="thread">
        <div class="thread-title">${thread.title}</div>
        <div class="user-row">
          <span>${user.username}</span>
          ${badge}
        </div>
      </div>
    `;
  });
}

loadThreads();

/* ---------- REALTIME ---------- */

supabase.channel("forum-realtime")
  .on("postgres_changes", { event:"*", schema:"public", table:"threads" }, () => {
    loadThreads();
  })
  .subscribe();

</script>
</body>
</html>
