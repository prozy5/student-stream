<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StudentStream System Status</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:#070b12;
  color:#fff;
}

header{
  padding:20px 24px;
  border-bottom:1px solid #1c2533;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  font-size:20px;
  font-weight:900;
  color:#4da3ff;
}

.container{
  max-width:1100px;
  margin:40px auto;
  padding:0 24px;
}

.overall{
  background:#0e1522;
  border:1px solid #1f2a3a;
  border-radius:14px;
  padding:20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:30px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:16px;
}

.card{
  background:#0e1522;
  border:1px solid #1f2a3a;
  border-radius:14px;
  padding:18px;
}

.card b{
  font-size:16px;
}

.service{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:12px;
  font-size:14px;
}

.dot{
  display:inline-block;
  width:8px;
  height:8px;
  border-radius:50%;
  margin-right:6px;
}

.up{background:#3cff7a}
.down{background:#ff4d4d}
.degraded{background:#ffb84d}

.status-good{color:#3cff7a}
.status-bad{color:#ff4d4d}
.status-warn{color:#ffb84d}

footer{
  border-top:1px solid #1c2533;
  margin-top:60px;
  padding:30px;
  text-align:center;
  font-size:13px;
  opacity:.6;
}
</style>
</head>
<body>

<header>
  <div class="logo">StudentStream Status</div>
  <div style="opacity:.6;font-size:14px">Live System Health</div>
</header>

<div class="container">

  <div class="overall">
    <div>
      <b id="overallText">Loading...</b>
      <div style="font-size:13px;opacity:.6">Real-time platform status</div>
    </div>
    <div id="overallDot">●</div>
  </div>

  <div class="grid"></div>

</div>

<footer>
  © 2026 StudentStream · Infrastructure Status
</footer>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://iabzmoxzbqzcqgypxctr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
);

const grid = document.querySelector(".grid");
const overallText = document.getElementById("overallText");
const overallDot = document.getElementById("overallDot");

async function loadStatus(){
  const { data, error } = await supabase
    .from("system_status")
    .select("*")
    .order("division");

  if(error){
    console.error(error);
    overallText.textContent = "Unable to load system status";
    return;
  }

  renderStatus(data);
}

function renderStatus(rows){
  const divisions = {};
  let hasDown = false;
  let hasDegraded = false;

  rows.forEach(r=>{
    if(!divisions[r.division]) divisions[r.division]=[];
    divisions[r.division].push(r);

    if(r.status === "down") hasDown = true;
    if(r.status === "degraded") hasDegraded = true;
  });

  grid.innerHTML = "";

  Object.entries(divisions).forEach(([division, services])=>{
    const card = document.createElement("div");
    card.className = "card";

    let html = `<b>${division}</b>`;

    services.forEach(s=>{
      let dotClass = "up";
      let statusClass = "status-good";

      if(s.status === "down"){
        dotClass = "down";
        statusClass = "status-bad";
      }
      if(s.status === "degraded"){
        dotClass = "degraded";
        statusClass = "status-warn";
      }

      html += `
        <div class="service">
          <span><span class="dot ${dotClass}"></span>${s.service}</span>
          <span class="${statusClass}">${capitalize(s.status)}</span>
        </div>
      `;
    });

    card.innerHTML = html;
    grid.appendChild(card);
  });

  if(hasDown){
    overallText.textContent = "Major System Outage";
    overallDot.textContent = "● Down";
    overallDot.className = "status-bad";
  } else if(hasDegraded){
    overallText.textContent = "Partial System Degradation";
    overallDot.textContent = "● Degraded";
    overallDot.className = "status-warn";
  } else {
    overallText.textContent = "All Systems Operational";
    overallDot.textContent = "● Operational";
    overallDot.className = "status-good";
  }
}

function capitalize(s){
  return s.charAt(0).toUpperCase()+s.slice(1);
}

loadStatus();

// auto refresh every 30 seconds
setInterval(loadStatus, 30000);
</script>

</body>
</html>