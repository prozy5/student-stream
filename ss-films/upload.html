<!DOCTYPE html>
<html>
<head>
  <title>Upload Film – SS Films</title>
  <meta charset="UTF-8">
  <style>
    body { background:#0b0f14;color:#fff;font-family:sans-serif;padding:20px }
    input,button { padding:10px;margin:10px 0;width:100% }
    button { background:#1f6feb;color:white;border:none }
  </style>
</head>
<body>

<h2>Upload Film</h2>

<input id="title" placeholder="Film title">
<input id="description" placeholder="Description">
<input type="file" id="videoFile" accept="video/*">
<input type="file" id="thumbFile" accept="image/*">

<button onclick="uploadFilm()">Upload</button>

<p id="status"></p>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://iabzmoxzbqzcqgypxctr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
);

window.uploadFilm = async () => {
  const title = document.getElementById("title").value;
  const description = document.getElementById("description").value;
  const video = document.getElementById("videoFile").files[0];
  const thumb = document.getElementById("thumbFile").files[0];
  const status = document.getElementById("status");

  if (!video || !thumb) {
    status.innerText = "Missing files";
    return;
  }

  const videoPath = `films/${Date.now()}_${video.name}`;
  const thumbPath = `thumbs/${Date.now()}_${thumb.name}`;

  status.innerText = "Uploading video...";

  const { error: vErr } = await supabase.storage
    .from("films")
    .upload(videoPath, video);

  if (vErr) return status.innerText = vErr.message;

  const { error: tErr } = await supabase.storage
    .from("thumbnails")
    .upload(thumbPath, thumb);

  if (tErr) return status.innerText = tErr.message;

  const videoURL = supabase.storage.from("films").getPublicUrl(videoPath).data.publicUrl;
  const thumbURL = supabase.storage.from("thumbnails").getPublicUrl(thumbPath).data.publicUrl;

  const { error: dbErr } = await supabase.from("films").insert([{
    title,
    description,
    video_url: videoURL,
    thumbnail_url: thumbURL
  }]);

  if (dbErr) return status.innerText = dbErr.message;

  status.innerText = "✅ Upload successful!";
};
</script>

</body>
</html>