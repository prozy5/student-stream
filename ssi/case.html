<!DOCTYPE html>
<html>
<head>
<title>Case File</title>
<style>
body{background:#05070d;color:#dbe7ff;font-family:sans-serif;padding:20px}
textarea,input,button{width:100%;padding:10px;margin:5px 0;background:#020617;color:white;border:1px solid #334155}
.comment{border-bottom:1px solid #1e293b;padding:5px}
</style>
</head>
<body>

<h2 id="title"></h2>
<p id="desc"></p>

<h3>Comments</h3>
<div id="comments"></div>

<textarea id="msg" placeholder="Write comment"></textarea>
<button onclick="post()">Post</button>

<script type="module">
import { supabase } from "./supabase.js";

const id=new URLSearchParams(location.search).get("id");

async function load(){
  const {data:c}=await supabase.from("cases").select().eq("id",id).single();
  title.innerText=c.title;
  desc.innerText=c.description;

  const {data:comments}=await supabase.from("comments").select().eq("case_id",id);
  commentsDiv.innerHTML=comments.map(x=>`<div class="comment"><b>${x.author}</b>: ${x.message}</div>`).join("");
}

async function post(){
  await supabase.from("comments").insert({
    case_id:id,
    author:"Public",
    message:msg.value
  });
  msg.value="";
  load();
}

const commentsDiv=document.getElementById("comments");
load();
</script>

</body>
</html>