<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StudentStream Status</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root {
  --bg: #0b1020;
  --card: #121a33;
  --text: #e6ecff;
  --muted: #9aa4c7;
  --good: #22c55e;
  --bad: #ef4444;
  --warn: #facc15;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(160deg,#0b1020,#05080f);
  color: var(--text);
}

header {
  padding: 24px;
  text-align: center;
}

header h1 {
  margin: 0;
  font-size: 26px;
}

header p {
  color: var(--muted);
  margin-top: 6px;
}

.container {
  max-width: 900px;
  margin: auto;
  padding: 20px;
}

.card {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 10px 25px rgba(0,0,0,.3);
}

.services {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
  gap: 14px;
}

.service {
  background: #0f1630;
  border-radius: 12px;
  padding: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.status {
  font-weight: bold;
  font-size: 14px;
}

.operational { color: var(--good); }
.degraded { color: var(--warn); }
.down { color: var(--bad); }

.incident {
  border-left: 4px solid var(--warn);
  padding-left: 12px;
  margin-bottom: 12px;
}

.incident small {
  color: var(--muted);
}

footer {
  text-align: center;
  padding: 20px;
  color: var(--muted);
  font-size: 13px;
}

@media(max-width:600px){
  header h1 { font-size: 22px; }
}
</style>
</head>
<body>

<header>
  <h1>StudentStream System Status</h1>
  <p>Live service availability & platform health</p>
</header>

<div class="container">

  <div class="card">
    <h2>Services</h2>
    <div class="services" id="services"></div>
  </div>

  <div class="card">
    <h2>Incidents</h2>
    <div id="incidents"></div>
  </div>

</div>

<footer>
  Powered by StudentStream Cloud Infrastructure
</footer>

<script>
const SUPABASE_URL = "https://iabzmoxzbqzcqgypxctr.supabase.co";
const SUPABASE_KEY = "https://iabzmoxzbqzcqgypxctr.supabase.co";

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const servicesDiv = document.getElementById("services");
const incidentsDiv = document.getElementById("incidents");

function statusClass(status){
  if(status === "operational") return "operational";
  if(status === "degraded") return "degraded";
  return "down";
}

async function loadServices(){
  const { data } = await supabase.from("services").select("*").order("id");
  servicesDiv.innerHTML = "";
  data.forEach(s=>{
    const el = document.createElement("div");
    el.className = "service";
    el.innerHTML = `
      <span>${s.name}</span>
      <span class="status ${statusClass(s.status)}">${s.status}</span>
    `;
    servicesDiv.appendChild(el);
  });
}

async function loadIncidents(){
  const { data } = await supabase
    .from("incidents")
    .select("*")
    .order("created_at",{ascending:false})
    .limit(10);

  incidentsDiv.innerHTML = "";

  if(!data.length){
    incidentsDiv.innerHTML = "<p style='color:var(--muted)'>No incidents reported.</p>";
    return;
  }

  data.forEach(i=>{
    const el = document.createElement("div");
    el.className = "incident";
    el.innerHTML = `
      <strong>${i.title || "Incident"}</strong><br>
      ${i.description || ""}
      <br><small>${new Date(i.created_at).toLocaleString()}</small>
    `;
    incidentsDiv.appendChild(el);
  });
}

function setupRealtime(){
  supabase.channel("status-updates")
    .on("postgres_changes",{event:"*",schema:"public",table:"services"},loadServices)
    .on("postgres_changes",{event:"*",schema:"public",table:"incidents"},loadIncidents)
    .subscribe();
}

loadServices();
loadIncidents();
setupRealtime();
</script>

</body>
</html>