<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SS:I Agent Console</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h1>SS:I Agent Console</h1>

<section>
<h2>Create New Case</h2>
<input id="title" placeholder="Case Title"><br>
<textarea id="desc" placeholder="Description"></textarea><br>
<button onclick="createCase()">Create Case</button>
</section>

<section>
<h2>Upload Evidence</h2>
<input id="caseId" placeholder="Case UUID"><br>
<input type="file" id="file"><br>
<button onclick="uploadFile()">Upload</button>
</section>

<div id="status"></div>

<script type="module">
import { supabase } from './supabase.js';

window.createCase = async function() {
  const title = document.getElementById('title').value;
  const desc = document.getElementById('desc').value;

  const { data } = await supabase.from('cases').insert({
    title,
    description: desc,
    status: 'OPEN'
  }).select().single();

  document.getElementById('status').innerText = "Case created: " + data.id;
}

window.uploadFile = async function() {
  const caseId = document.getElementById('caseId').value;
  const file = document.getElementById('file').files[0];

  const path = `${caseId}/${file.name}`;

  await supabase.storage.from('case-files').upload(path, file);

  await supabase.from('case_files').insert({
    case_id: caseId,
    file_name: file.name,
    file_path: path,
    file_type: file.type,
    uploaded_by: 'Agent'
  });

  document.getElementById('status').innerText = "File uploaded.";
}
</script>
</body>
</html>